import{u as M,a as L,r as j,j as e,L as p,b as v,c as _,R as i,d as E,g as k}from"./index-Ck9agymx.js";import{u as B,t as T}from"./types-VK2oKv9X.js";import{c as V,B as u}from"./button-DZcKRNoB.js";import{I as O}from"./input-96zCdkwo.js";import{L as A}from"./label-DtEBgE9a.js";import{C as z,b as P,c as F,a as U}from"./card-CYQnxe6u.js";import{l as Y}from"./auth-DSsh2_HB.js";import{A as G}from"./alert-circle-DkTN4TV4.js";import{U as H}from"./user-BHb0lJ3D.js";import{B as J}from"./building-5AwgBSTz.js";import"./index-CoHPqngH.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=V("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);function oe(){var g;const o=M(),C=L(),[x,d]=j.useState(null),[c,h]=j.useState(!1),n=((g=C.state)==null?void 0:g.from)||null,R=B({resolver:T(Y),defaultValues:{email:"",password:""}}),{register:f,handleSubmit:I,formState:{errors:m}}=R,S=async l=>{var N,b,y,w;try{h(!0),d(null);const t=await v.login(l.email,l.password),r=await v.getCurrentUser();localStorage.setItem("user",JSON.stringify(r));const s=r.roles||[];if(s.includes("ROLE_CANDIDAT"))try{const a=await _.getMyProfile();a.status!=="DRAFT"||a.last_step_completed!==null&&a.last_step_completed>=7?o(n||i.CANDIDATE_DASHBOARD,{replace:!0}):o(i.ONBOARDING,{replace:!0})}catch(a){((N=a.response)==null?void 0:N.status)===404?o(i.ONBOARDING,{replace:!0}):(console.error("Erreur lors de la récupération du profil:",a),o(i.ONBOARDING,{replace:!0}))}else if(s.includes("ROLE_COMPANY_ADMIN"))try{await E.getMyCompany(),o(n||i.COMPANY_DASHBOARD,{replace:!0})}catch(a){((b=a.response)==null?void 0:b.status)===404?o(i.COMPANY_ONBOARDING,{replace:!0}):(console.error("Erreur lors de la récupération de l'entreprise:",a),o(i.COMPANY_ONBOARDING,{replace:!0}))}else if(s.includes("ROLE_RECRUITER"))try{await E.getMyCompany(),o(n||i.COMPANY_DASHBOARD,{replace:!0})}catch(a){console.error("Erreur: Le recruteur n'est pas associé à une entreprise:",a),d("Votre compte n'est pas encore associé à une entreprise. Contactez votre administrateur.")}else s.includes("ROLE_ADMIN")||s.includes("ROLE_SUPER_ADMIN")?o(n||i.ADMIN_DASHBOARD,{replace:!0}):o(n||k(s),{replace:!0})}catch(t){console.error("Erreur de connexion:",t),console.error("Erreur response:",t.response),console.error("Erreur response data:",(y=t.response)==null?void 0:y.data);let r="Email ou mot de passe incorrect. Veuillez réessayer.";if(!t.response&&(t.request||t.code==="ERR_NETWORK"||t.message==="Network Error"))r="Impossible de contacter le serveur. Vérifiez que les services backend sont démarrés (docker-compose up auth candidate …).";else if((w=t.response)!=null&&w.data){const s=t.response.data;s.detail?r=typeof s.detail=="string"?s.detail:JSON.stringify(s.detail):s.message?r=typeof s.message=="string"?s.message:JSON.stringify(s.message):typeof s=="string"?r=s:s.error?r=typeof s.error=="string"?s.error:JSON.stringify(s.error):r=`Erreur ${t.response.status||"inconnue"}: ${JSON.stringify(s)}`}else t.message?r=t.message:t.request&&(r="Impossible de contacter le serveur. Vérifiez votre connexion.");if(r.includes("HTTPException")&&r.includes("detail=")){const s=r.match(/detail=['"]([^'"]+)['"]/);s&&s[1]&&(r=s[1])}r==="Invalid credentials"||r.includes("Invalid credentials")?r="Email ou mot de passe incorrect. Veuillez réessayer.":r==="User account is not active"&&(r="Votre compte n'est pas actif. Veuillez contacter le support."),d(r)}finally{h(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-light to-white flex items-center justify-center p-3 sm:p-4 md:p-6",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(z,{className:"rounded-[16px] shadow-xl border-0 overflow-hidden",children:[e.jsx("div",{className:"p-4 sm:p-6 text-white",style:{background:"linear-gradient(to right, #226D68, #1a5a55)"},children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center flex-shrink-0",children:e.jsx(D,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(P,{className:"text-xl sm:text-2xl font-bold font-heading text-white truncate",children:"Connexion"}),e.jsx(F,{className:"text-white/80 mt-1 text-xs sm:text-sm",children:"Connectez-vous à votre compte Yemma Solutions"})]})]})}),e.jsxs(U,{className:"p-4 sm:p-6",children:[e.jsxs("form",{onSubmit:I(S),className:"space-y-4 sm:space-y-5",children:[x&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg flex items-start gap-2 animate-in slide-in-from-top-2",children:[e.jsx(G,{className:"w-4 h-4 sm:w-5 sm:h-5 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs sm:text-sm flex-1",children:x})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"email",className:"text-sm font-semibold",children:"Email"}),e.jsx(O,{id:"email",type:"email",placeholder:"votre@email.com",...f("email"),disabled:c,className:"h-10 sm:h-11 text-sm sm:text-base"}),m.email&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:m.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",className:"text-sm font-semibold",children:"Mot de passe"}),e.jsx(O,{id:"password",type:"password",placeholder:"••••••••",...f("password"),disabled:c,className:"h-10 sm:h-11 text-sm sm:text-base"}),m.password&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:m.password.message})]}),e.jsx("div",{className:"flex items-center justify-between text-xs sm:text-sm",children:e.jsx(p,{to:"/reset-password",className:"hover:underline transition-colors",style:{color:"#226D68"},onMouseEnter:l=>l.target.style.color="#1a5a55",onMouseLeave:l=>l.target.style.color="#226D68",children:"Mot de passe oublié ?"})}),e.jsx(u,{type:"submit",className:"w-full text-white h-11 sm:h-12 text-sm sm:text-base font-semibold transition-all duration-200 shadow-md hover:shadow-lg",style:{backgroundColor:"#226D68"},onMouseEnter:l=>{l.currentTarget.style.backgroundColor="#1a5a55"},onMouseLeave:l=>{l.currentTarget.style.backgroundColor="#226D68"},disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Connexion en cours..."}),e.jsx("span",{className:"sm:hidden",children:"Connexion..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Se connecter"]})})]}),e.jsxs("div",{className:"mt-5 sm:mt-6 pt-5 sm:pt-6 border-t",children:[e.jsx("p",{className:"text-xs sm:text-sm text-center text-muted-foreground mb-3 sm:mb-4",children:"Vous n'avez pas de compte ?"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[e.jsx(p,{to:"/register/candidat",className:"w-full",children:e.jsxs(u,{variant:"outline",className:"w-full border-blue-deep text-blue-deep hover:bg-blue-deep/10 h-10 sm:h-11 text-xs sm:text-sm",children:[e.jsx(H,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2"}),"Candidat"]})}),e.jsx(p,{to:"/register/company",className:"w-full",children:e.jsxs(u,{variant:"outline",className:"w-full border-blue-deep text-blue-deep hover:bg-blue-deep/10 h-10 sm:h-11 text-xs sm:text-sm",children:[e.jsx(J,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5 sm:mr-2"}),"Entreprise"]})})]})]})]})]})})})}export{oe as default};
