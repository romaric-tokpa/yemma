import{u as J,r as m,c as u,j as e,f}from"./index-Cg1svvI5.js";import{u as L,t as A,o as O,n as U,s as o}from"./types-BlmR3YhF.js";import{B as j}from"./button-wtSf44PI.js";import{I as i}from"./input-j75cJiPX.js";import{L as a}from"./label-CXq0_ejY.js";import{T as z}from"./textarea-8LaMF0_o.js";import{C as M,d as G,b as I,c as R,a as V}from"./card-zq6uNjQt.js";import{L as N}from"./loader-2-DrGK7uFY.js";import{A as k}from"./arrow-left-B-1lI_0Z.js";import{S as W}from"./save-Cveq6rNw.js";import"./index-BktxQI8W.js";const H=O({firstName:o().min(2,"Le prénom doit contenir au moins 2 caractères"),lastName:o().min(2,"Le nom doit contenir au moins 2 caractères"),phone:o().optional(),dateOfBirth:o().optional(),nationality:o().optional(),address:o().optional(),city:o().optional(),country:o().optional(),profileTitle:o().optional(),professionalSummary:o().optional(),sector:o().optional(),mainJob:o().optional(),totalExperience:U().min(0).optional()});function ie(){const p=J(),[_,y]=m.useState(!0),[g,b]=m.useState(!1),[n,w]=m.useState(null),[v,S]=m.useState(null),[E,P]=m.useState(!1),T=L({resolver:A(H),defaultValues:{firstName:"",lastName:"",phone:"",dateOfBirth:"",nationality:"",address:"",city:"",country:"",profileTitle:"",professionalSummary:"",sector:"",mainJob:"",totalExperience:0}}),{register:r,handleSubmit:F,formState:{errors:x},setValue:t,watch:$}=T;m.useEffect(()=>{C()},[]);const C=async()=>{try{y(!0);const s=await u.getMyProfile();w(s),S(s.photo_url),t("firstName",s.first_name||""),t("lastName",s.last_name||""),t("phone",s.phone||""),t("dateOfBirth",s.date_of_birth?s.date_of_birth.split("T")[0]:""),t("nationality",s.nationality||""),t("address",s.address||""),t("city",s.city||""),t("country",s.country||""),t("profileTitle",s.profile_title||""),t("professionalSummary",s.professional_summary||""),t("sector",s.sector||""),t("mainJob",s.main_job||""),t("totalExperience",s.total_experience||0)}catch(s){console.error("Error loading profile:",s),alert("Erreur lors du chargement du profil"),p("/candidate/dashboard")}finally{y(!1)}},B=async s=>{var h;const c=(h=s.target.files)==null?void 0:h[0];if(!(!c||!(n!=null&&n.id))){if(!c.type.startsWith("image/")){alert("Veuillez sélectionner une image (JPG, PNG)");return}if(c.size>5*1024*1024){alert("La photo ne doit pas dépasser 5MB");return}try{P(!0);const l=await f.uploadProfilePhoto(c,n.id);let d=l.serve_url;d&&d.startsWith("/")?d=f.getDocumentServeUrl(l.id):l.id&&(d=f.getDocumentServeUrl(l.id)),await u.updateProfile(n.id,{photo_url:d}),S(d)}catch(l){console.error("Error uploading photo:",l),alert("Erreur lors du téléchargement de la photo")}finally{P(!1)}}},D=async s=>{var c,h;if(n!=null&&n.id)try{b(!0);const l={first_name:s.firstName,last_name:s.lastName,phone:s.phone||null,date_of_birth:s.dateOfBirth?`${s.dateOfBirth}T00:00:00`:null,nationality:s.nationality||null,address:s.address||null,city:s.city||null,country:s.country||null,profile_title:s.profileTitle||null,professional_summary:s.professionalSummary||null,sector:s.sector||null,main_job:s.mainJob||null,total_experience:s.totalExperience||null};await u.updateProfile(n.id,l),p("/candidate/dashboard")}catch(l){console.error("Error updating profile:",l),alert("Erreur lors de la mise à jour: "+(((h=(c=l.response)==null?void 0:c.data)==null?void 0:h.detail)||l.message))}finally{b(!1)}};return _?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-light to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-[#226D68]"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-light to-white",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(j,{variant:"ghost",onClick:()=>p("/candidate/dashboard"),className:"mb-4",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Retour"]}),e.jsx("h1",{className:"text-3xl font-bold font-heading text-gray-anthracite",children:"Modifier mon profil"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Mettez à jour vos informations personnelles"})]}),e.jsxs(M,{className:"rounded-[16px] shadow-lg border-0 overflow-hidden",children:[e.jsxs(G,{className:"bg-gradient-to-r from-[#226D68]/5 to-blue-deep/5 border-b",children:[e.jsx(I,{className:"text-2xl font-bold text-gray-anthracite font-heading",children:"Informations personnelles"}),e.jsx(R,{children:"Modifiez vos informations de base"})]}),e.jsx(V,{className:"p-8",children:e.jsxs("form",{onSubmit:F(D),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(a,{children:"Photo de profil"}),e.jsxs("div",{className:"flex items-center gap-6",children:[v&&e.jsx("img",{src:v,alt:"Photo de profil",className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200",onError:s=>{s.target.style.display="none"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx(i,{type:"file",accept:"image/*",onChange:B,disabled:E,className:"max-w-xs"}),E&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 animate-spin"}),"Téléchargement en cours..."]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Formats acceptés: JPG, PNG. Taille maximale: 5 Mo"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"firstName",children:"Prénom *"}),e.jsx(i,{id:"firstName",...r("firstName"),className:"h-11"}),x.firstName&&e.jsx("p",{className:"text-sm text-red-600",children:x.firstName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"lastName",children:"Nom *"}),e.jsx(i,{id:"lastName",...r("lastName"),className:"h-11"}),x.lastName&&e.jsx("p",{className:"text-sm text-red-600",children:x.lastName.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"phone",children:"Téléphone"}),e.jsx(i,{id:"phone",...r("phone"),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"dateOfBirth",children:"Date de naissance"}),e.jsx(i,{id:"dateOfBirth",type:"date",...r("dateOfBirth"),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"nationality",children:"Nationalité"}),e.jsx(i,{id:"nationality",...r("nationality"),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"address",children:"Adresse"}),e.jsx(i,{id:"address",...r("address"),className:"h-11"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"city",children:"Ville"}),e.jsx(i,{id:"city",...r("city"),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"country",children:"Pays"}),e.jsx(i,{id:"country",...r("country"),className:"h-11"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"profileTitle",children:"Titre du profil"}),e.jsx(i,{id:"profileTitle",placeholder:"Ex: Ingénieur Génie Civil",...r("profileTitle"),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"professionalSummary",children:"Résumé professionnel"}),e.jsx(z,{id:"professionalSummary",placeholder:"Décrivez votre parcours professionnel...",...r("professionalSummary"),rows:6,className:"resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"sector",children:"Secteur"}),e.jsx(i,{id:"sector",...r("sector"),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"mainJob",children:"Poste principal"}),e.jsx(i,{id:"mainJob",...r("mainJob"),className:"h-11"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"totalExperience",children:"Années d'expérience"}),e.jsx(i,{id:"totalExperience",type:"number",min:"0",...r("totalExperience",{valueAsNumber:!0}),className:"h-11"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>p("/candidate/dashboard"),className:"border-blue-deep text-blue-deep hover:bg-blue-deep/10",children:"Annuler"}),e.jsx(j,{type:"submit",disabled:g,className:"bg-[#226D68] hover:bg-[#1a5a55] text-white",children:g?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Enregistrer"]})})]})]})})]})]})})}export{ie as default};
