import{u as B,e as H,r as d,j as e,d as k,b as A}from"./index-Ck9agymx.js";import{u as G,t as K,o as Q,s as j}from"./types-VK2oKv9X.js";import{B as D}from"./button-DZcKRNoB.js";import{I as N}from"./input-96zCdkwo.js";import{L as w}from"./label-DtEBgE9a.js";import{C as y,d as V,b as F,c as T,a as b}from"./card-CYQnxe6u.js";import{L as C}from"./loader-2-p7aSMtdV.js";import{C as q}from"./check-circle-2-DmS9kAcz.js";import{L as I}from"./lock-B4910_4k.js";import{A as W}from"./alert-circle-DkTN4TV4.js";import{U as z}from"./user-BHb0lJ3D.js";import"./index-CoHPqngH.js";const X=Q({first_name:j().min(1,"Le prÃ©nom est requis").max(100,"Le prÃ©nom est trop long"),last_name:j().min(1,"Le nom est requis").max(100,"Le nom est trop long"),password:j().min(8,"Le mot de passe doit contenir au moins 8 caractÃ¨res"),confirm_password:j().min(8,"La confirmation du mot de passe est requise")}).refine(c=>c.password===c.confirm_password,{message:"Les mots de passe ne correspondent pas",path:["confirm_password"]});function me(){console.log("ðŸ”µ AcceptInvitation component is rendering");const c=B(),[J]=H(),n=J.get("token");console.log("ðŸ”µ AcceptInvitation - token from URL:",n);const[m,S]=d.useState(!1),[E,_]=d.useState(!0),[g,o]=d.useState(null),[L,O]=d.useState(!1),[a,R]=d.useState(null),M=G({resolver:K(X),defaultValues:{first_name:"",last_name:"",password:"",confirm_password:""}}),{register:v,handleSubmit:P,formState:{errors:i}}=M;d.useEffect(()=>{if(console.log("AcceptInvitation useEffect - token:",n),!n){console.log("No token found, setting error"),o("Token d'invitation manquant. Veuillez utiliser le lien reÃ§u par email."),_(!1);return}(async()=>{var p,u,x,f,h;try{_(!0),console.log("Loading invitation with token:",n);const s=await k.validateInvitation(n);console.log("Invitation loaded successfully:",s),R(s),o(null)}catch(s){console.error("Error loading invitation:",s),console.error("Error details:",{message:s.message,response:(p=s.response)==null?void 0:p.data,status:(u=s.response)==null?void 0:u.status,url:(x=s.config)==null?void 0:x.url}),((f=s.response)==null?void 0:f.status)===404?o("Invitation non trouvÃ©e ou expirÃ©e."):((h=s.response)==null?void 0:h.status)===400?o("Cette invitation a dÃ©jÃ  Ã©tÃ© utilisÃ©e ou est expirÃ©e."):o(`Erreur lors du chargement de l'invitation: ${s.message||"Erreur inconnue"}`)}finally{_(!1)}})()},[n]);const U=async l=>{var p,u,x,f,h;if(!n){o("Token d'invitation manquant");return}S(!0),o(null),console.log("ðŸ”µ Submitting invitation acceptance with data:",{token:n.substring(0,20)+"...",first_name:l.first_name,last_name:l.last_name,password_length:(p=l.password)==null?void 0:p.length});try{console.log("ðŸ”µ Calling companyApi.acceptInvitation...");const s=await k.acceptInvitation({token:n,first_name:l.first_name,last_name:l.last_name,password:l.password});console.log("ðŸ”µ Invitation accepted successfully:",s);const r=a==null?void 0:a.email;if(!r)throw new Error("Impossible de rÃ©cupÃ©rer l'email de l'invitation");try{const t=await A.login(r,l.password),$=await A.getCurrentUser();localStorage.setItem("user",JSON.stringify($)),O(!0),setTimeout(()=>{c("/company/search")},2e3)}catch{o("Compte crÃ©Ã© avec succÃ¨s, mais la connexion automatique a Ã©chouÃ©. Veuillez vous connecter manuellement."),setTimeout(()=>{c("/login")},3e3)}}catch(s){console.error("âŒ Error accepting invitation:",s),console.error("âŒ Error response:",s.response),console.error("âŒ Error response status:",(u=s.response)==null?void 0:u.status),console.error("âŒ Error response data:",(x=s.response)==null?void 0:x.data),console.error("âŒ Error response headers:",(f=s.response)==null?void 0:f.headers),console.error("âŒ Error message:",s.message),console.error("âŒ Full error object:",JSON.stringify(s,null,2));let r="Erreur lors de la crÃ©ation du compte. Veuillez rÃ©essayer.";if((h=s.response)!=null&&h.data){const t=s.response.data;t.detail?r=typeof t.detail=="string"?t.detail:JSON.stringify(t.detail):t.message?r=typeof t.message=="string"?t.message:JSON.stringify(t.message):typeof t=="string"?r=t:t.error?r=typeof t.error=="string"?t.error:JSON.stringify(t.error):r=`Erreur ${s.response.status||"inconnue"}: ${JSON.stringify(t)}`}else s.message?r=s.message:s.request&&(r="Impossible de contacter le serveur. VÃ©rifiez votre connexion.");if(r.includes("HTTPException")&&r.includes("detail=")){const t=r.match(/detail=['"]([^'"]+)['"]/);t&&t[1]&&(r=t[1])}console.error("âŒ Final error message:",r),o(r)}finally{S(!1)}};return console.log("ðŸ”µ AcceptInvitation render check - token:",n,"loadingInvitation:",E,"error:",g,"success:",L),n?E?e.jsx("div",{className:"min-h-screen bg-gray-light flex items-center justify-center p-4 relative",children:e.jsx(y,{className:"w-full max-w-md",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-[#226D68]"}),e.jsx("p",{className:"text-muted-foreground",children:"VÃ©rification de l'invitation..."})]})})})}):L?e.jsx("div",{className:"min-h-screen bg-gray-light flex items-center justify-center p-4 relative",children:e.jsx(y,{className:"w-full max-w-md",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"h-16 w-16 text-[#226D68] mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-anthracite mb-2",children:"Compte crÃ©Ã© avec succÃ¨s !"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Vous allez Ãªtre redirigÃ© vers votre espace de recherche..."}),e.jsx(C,{className:"h-6 w-6 animate-spin mx-auto text-[#226D68]"})]})})})}):(console.log("Rendering AcceptInvitation form, invitationInfo:",a,"error:",g),e.jsx("div",{className:"min-h-screen bg-gray-light flex items-center justify-center p-4 relative",children:e.jsxs(y,{className:"w-full max-w-md",children:[e.jsxs(V,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-[#226D68]/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(I,{className:"h-8 w-8 text-[#226D68]"})}),e.jsx(F,{className:"text-2xl font-bold text-gray-anthracite font-heading",children:"CrÃ©er votre compte"}),e.jsx(T,{children:"ComplÃ©tez le formulaire ci-dessous pour crÃ©er votre compte recruteur"}),(a==null?void 0:a.email)&&e.jsxs("div",{className:"mt-4 p-3 bg-[#226D68]/10 border border-[#226D68]/20 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Email du compte :"}),e.jsx("p",{className:"text-sm font-semibold text-gray-anthracite font-mono",children:a.email})]})]}),e.jsxs(b,{children:[e.jsxs("form",{onSubmit:P(U),className:"space-y-4",children:[g&&e.jsxs("div",{className:"bg-destructive/10 border border-destructive text-destructive px-4 py-3 rounded-md flex items-start gap-2",children:[e.jsx(W,{className:"w-5 h-5 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:g})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"first_name",children:["PrÃ©nom ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{id:"first_name",type:"text",placeholder:"Votre prÃ©nom",...v("first_name"),className:"pl-10",disabled:m||!a})]}),i.first_name&&e.jsx("p",{className:"text-sm text-destructive",children:i.first_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"last_name",children:["Nom ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{id:"last_name",type:"text",placeholder:"Votre nom",...v("last_name"),className:"pl-10",disabled:m||!a})]}),i.last_name&&e.jsx("p",{className:"text-sm text-destructive",children:i.last_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"password",children:["Mot de passe ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{id:"password",type:"password",placeholder:"Minimum 8 caractÃ¨res",...v("password"),className:"pl-10",disabled:m||!a})]}),i.password&&e.jsx("p",{className:"text-sm text-destructive",children:i.password.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"confirm_password",children:["Confirmer le mot de passe ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{id:"confirm_password",type:"password",placeholder:"RÃ©pÃ©tez votre mot de passe",...v("confirm_password"),className:"pl-10",disabled:m||!a})]}),i.confirm_password&&e.jsx("p",{className:"text-sm text-destructive",children:i.confirm_password.message})]}),e.jsx(D,{type:"submit",className:"w-full bg-[#226D68] hover:bg-[#1a5a55] text-white",disabled:m||!a,children:m?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"CrÃ©ation du compte..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"CrÃ©er mon compte"]})})]}),e.jsx("div",{className:"mt-6 pt-6 border-t",children:e.jsxs("p",{className:"text-sm text-center text-muted-foreground",children:["Vous avez dÃ©jÃ  un compte ?"," ",e.jsx("button",{onClick:()=>c("/login"),className:"text-[#226D68] hover:underline font-medium",children:"Se connecter"})]})})]})]})})):(console.log("ðŸ”µ No token, showing error message"),e.jsx("div",{className:"min-h-screen bg-gray-light flex items-center justify-center p-4 relative",children:e.jsxs(y,{className:"w-full max-w-md",children:[e.jsxs(V,{children:[e.jsx(F,{className:"text-2xl font-bold text-center",children:"Lien invalide"}),e.jsx(T,{className:"text-center",children:"Le lien d'invitation est invalide ou manquant."})]}),e.jsx(b,{children:e.jsx(D,{onClick:()=>c("/login"),className:"w-full",children:"Aller Ã  la page de connexion"})})]})}))}export{me as default};
