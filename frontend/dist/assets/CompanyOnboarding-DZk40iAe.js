import{u as ee,r as f,d as S,j as e,h as se,f as te}from"./index-BVcJJ-d5.js";import{u as ae,t as ne,o as re,p as y,i as me,s as g}from"./types-BVvxldXV.js";import{B}from"./button-ClsMRv7W.js";import{I as x}from"./input-CaWwssf1.js";import{L as p}from"./label-Cp4a06xu.js";import{C as le,b as ie,c as ce,a as oe}from"./card-YOGN1U3E.js";import{P as de}from"./progress-CFiLo9Z9.js";import{L as F}from"./loader-2-BwDrzhRd.js";import{S as xe}from"./save-C4-KvJe5.js";import{B as O}from"./building-BJF6UXZO.js";import{I as q}from"./image-CCqtwMVT.js";import{C as A}from"./check-circle-2-9pWl49_Q.js";import{A as pe}from"./alert-circle-DWr3Z1py.js";import{U}from"./user-CpvgTgdB.js";import{M as J}from"./mail-3AKkU4TZ.js";import{P as $}from"./phone-CU6NKycH.js";import{B as he}from"./briefcase-CqHPOuGd.js";import{A as ue}from"./arrow-left-P60v1Neu.js";import{A as fe}from"./arrow-right-Bp3kPr47.js";import"./index-BmV8OPo9.js";const ge=re({name:g().min(2,"Le nom de l'entreprise doit contenir au moins 2 caractères"),legal_id:g().min(9,"Le RCCM doit contenir au moins 9 caractères"),adresse:y(t=>t===""||t===null?void 0:t,g().min(10,"L'adresse doit contenir au moins 10 caractères").optional()),logo:me(FileList).optional(),contact_first_name:y(t=>t===""||t===null?void 0:t,g().min(2,"Le prénom doit contenir au moins 2 caractères").optional()),contact_last_name:y(t=>t===""||t===null?void 0:t,g().min(2,"Le nom doit contenir au moins 2 caractères").optional()),contact_email:y(t=>t===""||t===null?void 0:t,g().email("Email invalide").optional()),contact_phone:y(t=>t===""||t===null?void 0:t,g().optional()),contact_function:y(t=>t===""||t===null?void 0:t,g().min(2,"La fonction doit contenir au moins 2 caractères").optional())}),b=[{id:1,title:"Informations générales",description:"Nom, RCCM et adresse",icon:O},{id:2,title:"Contact du référent",description:"Informations du référent de l'entreprise",icon:O},{id:3,title:"Logo de l'entreprise",description:"Téléchargez le logo de votre entreprise",icon:q},{id:4,title:"Récapitulatif",description:"Vérifiez vos informations avant de finaliser",icon:A}];function ke(){const t=ee(),[n,v]=f.useState(1),[j,D]=f.useState(null),[_,T]=f.useState(null),[C,E]=f.useState(!1),[I,c]=f.useState(null),[G,M]=f.useState(!0),[R,L]=f.useState(null),W=ae({resolver:ne(ge),defaultValues:{name:"",legal_id:"",adresse:""}}),{register:h,handleSubmit:H,formState:{errors:l},watch:r,setValue:u,getValues:K}=W;f.useEffect(()=>{Q()},[]);const Q=async()=>{var s,o,i,m;try{M(!0),c(null);const a=await S.getMyCompany();D(a),T(a.logo_url),a&&(u("name",a.name||""),u("legal_id",a.legal_id||""),u("adresse",a.adresse||""),u("contact_first_name",a.contact_first_name||""),u("contact_last_name",a.contact_last_name||""),u("contact_email",a.contact_email||""),u("contact_phone",a.contact_phone||""),u("contact_function",a.contact_function||""))}catch(a){console.error("Error loading company:",a),((s=a.response)==null?void 0:s.status)===404?(D(null),c(null)):a.code==="ERR_NETWORK"||(o=a.message)!=null&&o.includes("Network Error")?c("Impossible de se connecter au serveur. Vérifiez votre connexion et que les services sont démarrés."):(m=(i=a.response)==null?void 0:i.data)!=null&&m.detail?c(`Erreur lors du chargement des données de l'entreprise: ${a.response.data.detail}`):c(`Erreur lors du chargement des données de l'entreprise: ${a.message||"Erreur inconnue"}`)}finally{M(!1)}},X=async s=>{var i,m,a,P;if(!s||s.length===0)return;const o=s[0];if(!o.type.startsWith("image/")){c("Le fichier doit être une image");return}if(o.size>5*1024*1024){c("Le fichier ne doit pas dépasser 5 Mo");return}try{E(!0),c(null);let N=j==null?void 0:j.id;if(!N){const d=K();if(!d.name||!d.legal_id){c("Veuillez remplir les informations générales (nom et RCCM) avant de télécharger le logo");return}try{const w=JSON.parse(localStorage.getItem("user")||"{}"),V=await S.createCompany({name:d.name,legal_id:d.legal_id,adresse:d.adresse||null,admin_id:w.id,contact_first_name:d.contact_first_name||null,contact_last_name:d.contact_last_name||null,contact_email:d.contact_email||null,contact_phone:d.contact_phone||null,contact_function:d.contact_function||null});N=V.id,D(V),L(new Date)}catch(w){console.error("Error creating company:",w),c("Erreur lors de la création de l'entreprise: "+(((m=(i=w.response)==null?void 0:i.data)==null?void 0:m.detail)||w.message));return}}const k=await te.uploadCompanyLogo(o,N);k.url&&(T(k.url),L(new Date))}catch(N){console.error("Error uploading logo:",N),c("Erreur lors du téléchargement du logo: "+(((P=(a=N.response)==null?void 0:a.data)==null?void 0:P.detail)||N.message))}finally{E(!1)}},Y=async s=>{var o,i;try{if(c(null),n===1){if(!s.name||!s.legal_id){c("Veuillez remplir tous les champs obligatoires");return}v(2),L(new Date)}else n===2?(v(3),L(new Date)):n===3?v(4):n===4&&await Z(s)}catch(m){console.error("Error in step submit:",m),c(((i=(o=m.response)==null?void 0:o.data)==null?void 0:i.detail)||"Une erreur est survenue")}},Z=async s=>{var o,i;try{if(E(!0),j!=null&&j.id)await S.updateCompany(j.id,{name:s.name,legal_id:s.legal_id,adresse:s.adresse||null,logo_url:_||null,contact_first_name:s.contact_first_name||null,contact_last_name:s.contact_last_name||null,contact_email:s.contact_email||null,contact_phone:s.contact_phone||null,contact_function:s.contact_function||null});else{const m=JSON.parse(localStorage.getItem("user")||"{}");await S.createCompany({name:s.name,legal_id:s.legal_id,adresse:s.adresse||null,logo_url:_||null,admin_id:m.id,contact_first_name:s.contact_first_name||null,contact_last_name:s.contact_last_name||null,contact_email:s.contact_email||null,contact_phone:s.contact_phone||null,contact_function:s.contact_function||null})}t("/company/dashboard")}catch(m){throw console.error("Error finalizing onboarding:",m),c(((i=(o=m.response)==null?void 0:o.data)==null?void 0:i.detail)||"Erreur lors de la finalisation"),m}finally{E(!1)}},z=(n-1)/(b.length-1)*100;return G?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-light to-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-[#226D68]"}),e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-light to-white",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#226D68] to-[#1a5a55] text-white shadow-lg",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 md:px-6 py-4 sm:py-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold font-heading mb-1 sm:mb-2",children:"Configuration de votre entreprise"}),e.jsx("p",{className:"text-xs sm:text-sm text-white/80",children:"Complétez les informations de votre entreprise pour commencer"})]}),R&&e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-white/80 flex-shrink-0",children:[e.jsx(xe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}),e.jsxs("span",{className:"hidden sm:inline",children:["Dernière sauvegarde: ",R.toLocaleTimeString()]}),e.jsx("span",{className:"sm:hidden",children:R.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:["Étape ",n," sur ",b.length]}),e.jsxs("span",{className:"text-xs sm:text-sm font-semibold",children:[Math.round(z),"% complété"]})]}),e.jsx(de,{value:z,className:"h-2 sm:h-3 bg-white/20"})]})]})}),e.jsx("div",{className:"bg-white border-b shadow-sm sticky top-0 z-40",children:e.jsx("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 md:px-6 py-3 sm:py-4",children:e.jsx("div",{className:"flex justify-between items-center overflow-x-auto pb-2 -mx-3 sm:mx-0 px-3 sm:px-0 scrollbar-hide",children:b.map((s,o)=>{const i=n>s.id,m=n===s.id,a=s.icon;return e.jsxs("div",{className:"flex items-center flex-1 min-w-[80px] sm:min-w-0",children:[e.jsxs("div",{className:"flex flex-col items-center flex-1 w-full",children:[e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center border-2 mb-1 sm:mb-2 transition-all duration-200 ${i?"bg-[#226D68] border-[#226D68] text-white shadow-md":m?"bg-[#226D68]/20 border-[#226D68] text-[#226D68] shadow-sm scale-110":"bg-white border-gray-300 text-gray-400"}`,children:i?e.jsx(A,{className:"w-5 h-5 sm:w-6 sm:h-6"}):e.jsx(a,{className:"w-5 h-5 sm:w-6 sm:h-6"})}),e.jsx("span",{className:`text-[10px] sm:text-xs text-center font-medium transition-colors leading-tight ${m?"text-[#226D68]":i?"text-gray-700":"text-gray-400"}`,children:s.title.split(" ")[0]})]}),o<b.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-1 sm:mx-2 transition-colors hidden sm:block ${i?"bg-[#226D68]":"bg-gray-200"}`})]},s.id)})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-3 sm:px-4 md:px-6 py-4 sm:py-6 md:py-8",children:e.jsxs(le,{className:"rounded-[16px] shadow-lg border-0 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-[#226D68]/5 to-blue-deep/5 p-4 sm:p-6 border-b",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-gradient-to-br from-[#226D68] to-blue-deep flex items-center justify-center text-white shadow-md flex-shrink-0",children:se.createElement(b[n-1].icon,{className:"w-6 h-6 sm:w-8 sm:h-8"})}),e.jsxs("div",{className:"text-center sm:text-left flex-1 min-w-0",children:[e.jsx(ie,{className:"text-xl sm:text-2xl font-bold text-gray-anthracite font-heading",children:b[n-1].title}),e.jsx(ce,{className:"text-sm sm:text-base mt-1",children:b[n-1].description})]})]})}),e.jsx(oe,{className:"p-4 sm:p-6 md:p-8",children:e.jsxs("form",{onSubmit:H(Y),className:"space-y-4 sm:space-y-6",children:[I&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg flex items-start gap-2 animate-in slide-in-from-top-2",children:[e.jsx(pe,{className:"w-4 h-4 sm:w-5 sm:h-5 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs sm:text-sm flex-1",children:I})]}),n===1&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",className:"text-sm sm:text-base font-semibold",children:"Nom de l'entreprise *"}),e.jsx(x,{id:"name",...h("name"),placeholder:"Ex: Acme Corporation",className:"h-10 sm:h-12 text-sm sm:text-base"}),l.name&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:l.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"legal_id",className:"text-sm sm:text-base font-semibold",children:"Numéro RCCM *"}),e.jsx(x,{id:"legal_id",...h("legal_id"),placeholder:"CI-ABJ-2024-A-12345",maxLength:50,className:"h-10 sm:h-12 text-sm sm:text-base"}),l.legal_id&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:l.legal_id.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Le RCCM (Registre du Commerce et du Crédit Mobilier) identifie votre entreprise"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"adresse",className:"text-sm sm:text-base font-semibold",children:"Adresse complète"}),e.jsx(x,{id:"adresse",...h("adresse"),placeholder:"123 Rue Example, 75001 Paris, France",className:"h-10 sm:h-12 text-sm sm:text-base"}),l.adresse&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:l.adresse.message})]})]}),n===2&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4 mb-4",children:e.jsxs("p",{className:"text-xs sm:text-sm text-blue-800",children:[e.jsx("strong",{children:"Information :"})," Ces informations concernent le référent principal de l'entreprise. Tous les champs sont optionnels."]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contact_first_name",className:"text-sm sm:text-base font-semibold flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Prénom du référent"]}),e.jsx(x,{id:"contact_first_name",...h("contact_first_name"),placeholder:"Ex: Jean",className:"h-10 sm:h-12 text-sm sm:text-base"}),l.contact_first_name&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:l.contact_first_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contact_last_name",className:"text-sm sm:text-base font-semibold flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Nom du référent"]}),e.jsx(x,{id:"contact_last_name",...h("contact_last_name"),placeholder:"Ex: Dupont",className:"h-10 sm:h-12 text-sm sm:text-base"}),l.contact_last_name&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:l.contact_last_name.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contact_email",className:"text-sm sm:text-base font-semibold flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Email du référent"]}),e.jsx(x,{id:"contact_email",type:"email",...h("contact_email"),placeholder:"Ex: jean.dupont@entreprise.com",className:"h-10 sm:h-12 text-sm sm:text-base"}),l.contact_email&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:l.contact_email.message})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contact_phone",className:"text-sm sm:text-base font-semibold flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Téléphone du référent"]}),e.jsx(x,{id:"contact_phone",type:"tel",...h("contact_phone"),placeholder:"Ex: +225 07 12 34 56 78",className:"h-10 sm:h-12 text-sm sm:text-base"}),l.contact_phone&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:l.contact_phone.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"contact_function",className:"text-sm sm:text-base font-semibold flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Fonction du référent"]}),e.jsx(x,{id:"contact_function",...h("contact_function"),placeholder:"Ex: Directeur RH, Responsable Recrutement",className:"h-10 sm:h-12 text-sm sm:text-base"}),l.contact_function&&e.jsx("p",{className:"text-xs sm:text-sm text-red-600 animate-in fade-in",children:l.contact_function.message})]})]})]}),n===3&&e.jsx("div",{className:"space-y-4 sm:space-y-6",children:e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx(p,{className:"text-sm sm:text-base font-semibold",children:"Logo de l'entreprise"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-[12px] p-6 sm:p-8 md:p-12 text-center bg-gray-50 hover:border-[#226D68] transition-colors",children:[_?e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("img",{src:_,alt:"Logo entreprise",className:"max-w-full sm:max-w-xs max-h-32 sm:max-h-40 mx-auto object-contain rounded-lg shadow-md",onError:s=>{s.target.style.display="none"}}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Logo actuel. Téléchargez une nouvelle image pour le remplacer."})]}):e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-24 sm:h-24 mx-auto bg-gradient-to-br from-[#226D68]/20 to-blue-deep/20 rounded-full flex items-center justify-center",children:e.jsx(q,{className:"w-8 h-8 sm:w-12 sm:h-12 text-[#226D68]"})}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground font-medium",children:"Aucun logo téléchargé"})]}),e.jsxs("div",{className:"mt-4 sm:mt-6",children:[e.jsx(x,{id:"logo",type:"file",accept:"image/*",disabled:C,onChange:s=>X(s.target.files),className:"max-w-full sm:max-w-xs mx-auto text-xs sm:text-sm"}),C&&e.jsxs("div",{className:"mt-3 sm:mt-4 flex items-center justify-center gap-2 text-xs sm:text-sm text-muted-foreground",children:[e.jsx(F,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Téléchargement en cours..."})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3 sm:mt-4",children:"Formats acceptés: JPG, PNG. Taille maximale: 5 Mo"})]})]})]})}),n===4&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-white p-4 sm:p-6 rounded-[12px] border border-gray-200 space-y-3 sm:space-4",children:[e.jsxs("div",{className:"pb-3 sm:pb-4 border-b border-gray-200",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground mb-1",children:"Nom de l'entreprise"}),e.jsx("p",{className:"text-base sm:text-lg font-semibold text-gray-900 truncate",children:r("name")})]}),e.jsxs("div",{className:"pb-3 sm:pb-4 border-b border-gray-200",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground mb-1",children:"RCCM"}),e.jsx("p",{className:"text-base sm:text-lg font-semibold text-gray-900 truncate",children:r("legal_id")})]}),r("adresse")&&e.jsxs("div",{className:"pb-3 sm:pb-4 border-b border-gray-200",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground mb-1",children:"Adresse"}),e.jsx("p",{className:"text-base sm:text-lg font-semibold text-gray-900 break-words",children:r("adresse")})]}),(r("contact_first_name")||r("contact_last_name")||r("contact_email")||r("contact_phone")||r("contact_function"))&&e.jsxs("div",{className:"pb-3 sm:pb-4 border-b border-gray-200",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground mb-2",children:"Contact du référent"}),e.jsxs("div",{className:"space-y-2",children:[(r("contact_first_name")||r("contact_last_name"))&&e.jsxs("p",{className:"text-base sm:text-lg font-semibold text-gray-900",children:[r("contact_first_name")," ",r("contact_last_name")]}),r("contact_function")&&e.jsx("p",{className:"text-sm text-gray-600",children:r("contact_function")}),r("contact_email")&&e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx(J,{className:"h-3 w-3"}),r("contact_email")]}),r("contact_phone")&&e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-2",children:[e.jsx($,{className:"h-3 w-3"}),r("contact_phone")]})]})]}),_&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-muted-foreground mb-2 sm:mb-3",children:"Logo"}),e.jsx("img",{src:_,alt:"Logo",className:"max-w-full sm:max-w-40 max-h-20 sm:max-h-24 object-contain rounded-lg shadow-sm border border-gray-200"})]})]}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground text-center",children:"Vérifiez que toutes les informations sont correctes avant de finaliser."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 sm:gap-4 pt-4 sm:pt-6 border-t",children:[e.jsxs(B,{type:"button",variant:"outline",onClick:()=>{n>1?v(n-1):t("/company/dashboard")},className:"border-blue-deep text-blue-deep hover:bg-blue-deep/10 w-full sm:w-auto order-2 sm:order-1",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),n===1?"Annuler":"Précédent"]}),e.jsx(B,{type:"submit",disabled:C,className:"bg-[#226D68] hover:bg-[#226D68]/90 text-white w-full sm:w-auto order-1 sm:order-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:"Enregistrement..."}),e.jsx("span",{className:"sm:hidden",children:"Enregistrement..."})]}):n===b.length?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Finaliser"]}):e.jsxs(e.Fragment,{children:["Suivant",e.jsx(fe,{className:"w-4 h-4 ml-2"})]})})]})]})})]})})]})}export{ke as default};
